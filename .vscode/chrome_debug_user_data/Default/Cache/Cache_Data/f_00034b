import { defineStore } from "/node_modules/.vite/deps/pinia.js?v=84e5e045";
import { URI, UserAgent } from "/node_modules/.vite/deps/sip__js.js?v=84e5e045";
import { ref } from "/node_modules/.vite/deps/vue.js?v=84e5e045";
import { Inviter, Invitation, Notification, SessionDescriptionHandler } from "/node_modules/.vite/deps/sip__js.js?v=84e5e045";
export const useSipStore = defineStore("sip", () => {
  const userAgent = ref();
  const voicemail = ref({ new: 0, old: 0 });
  const isDnd = ref(false);
  const isRegistered = ref(false);
  const isConnected = ref(false);
  const currentCall = ref(null);
  const incomingCall = ref(null);
  const callState = ref("idle");
  const connectionState = ref("disconnected");
  const callStartTime = ref(null);
  const error = ref(null);
  const isMuted = ref(false);
  const audioSender = ref(null);
  const sipConfig = ref({
    server: "wss://hornblower.doesnotexist.com:7443",
    username: "",
    password: "",
    domain: "hornblower.doesnotexist.com",
    displayName: ""
  });
  const initializeSip = async (config) => {
    try {
      sipConfig.value = { ...sipConfig.value, ...config };
      connectionState.value = "connecting";
      error.value = null;
      const uri = new URI("sip", sipConfig.value.username, sipConfig.value.domain, 5060);
      const transportOptions = {
        server: "wss://hornblower.doesnotexist.com:7443",
        connectionTimeout: 1e4,
        keepAliveInterval: 3e4,
        traceSip: true
      };
      const userAgentOptions = {
        uri,
        transportOptions,
        userAgentString: "SIP.js/0.7.8 SaraPhone 04",
        traceSip: true,
        iceCheckingTimeout: 1e3,
        registerExpires: 120,
        allowLegacyNotifications: true,
        hackWssInTransport: true,
        wsServerMaxReconnection: 5e3,
        wsServerReconnectionTimeout: 1,
        connectionRecoveryMaxInterval: 3,
        connectionRecoveryMinInterval: 2,
        delegate: {
          onConnect: () => {
            console.log("SIP conectado");
            isConnected.value = true;
            connectionState.value = "connected";
          },
          onDisconnect: (error2) => {
            console.log("SIP desconectado", error2);
            isConnected.value = false;
            isRegistered.value = false;
            connectionState.value = "disconnected";
            if (error2) {
              connectionState.value = "reconnecting";
              setTimeout(() => {
                if (userAgent.value) {
                  userAgent.value.start();
                }
              }, 5e3);
            }
          },
          onInvite: (invitation) => {
            if (isDnd.value) {
              console.log("Llamada entrante ignorada por DND");
              invitation.reject();
              return;
            }
            currentCall.value = invitation;
            callState.value = "ringing";
          }
        }
      };
      userAgent.value = new UserAgent(userAgentOptions);
      userAgent.value.delegate = {
        ...userAgent.value.delegate,
        onNotify: (notification) => {
          const body = notification.request.body;
          const match = body.match(/voice-message:\s*(\d+)\/(\d+)/i);
          if (match) {
            const newMessages = parseInt(match[1] ?? "0");
            const oldMessages = parseInt(match[2] ?? "0");
            voicemail.value = { new: newMessages, old: oldMessages };
          }
          notification.accept();
        }
      };
      await userAgent.value.start();
    } catch (err) {
      console.error("Error inicializando SIP:", err);
      connectionState.value = "disconnected";
    }
  };
  const makeCall = async (number) => {
    try {
      if (!userAgent.value || !isConnected.value) {
        throw new Error("SIP no estÃ¡ conectado");
      }
      const target = new URI("sip", number, sipConfig.value.domain);
      const inviter = new Inviter(userAgent.value, target, {
        sessionDescriptionHandlerOptions: {
          constraints: { audio: true, video: false }
        }
      });
      currentCall.value = inviter;
      callState.value = "calling";
      callStartTime.value = /* @__PURE__ */ new Date();
      inviter.stateChange.addListener((state) => {
        if (state === "Established") {
          const handler = inviter.sessionDescriptionHandler;
          const pc = handler.peerConnection;
          const session = inviter.sessionDescriptionHandler;
          if (session && session.peerConnection) {
            const senders = session.peerConnection.getSenders();
            audioSender.value = senders.find((sender) => sender.track?.kind === "audio") || null;
          }
        }
        if (state === "Terminated") {
          audioSender.value = null;
          isMuted.value = false;
        }
      });
      await inviter.invite();
      return true;
    } catch (err) {
      console.error("Error haciendo llamada:", err);
      callState.value = "idle";
      currentCall.value = null;
      return false;
    }
  };
  const endCall = async () => {
    try {
      if (currentCall.value) {
        if (currentCall.value instanceof Inviter) {
          await currentCall.value.cancel();
        } else {
        }
      }
      callState.value = "ended";
      currentCall.value = null;
      callStartTime.value = null;
    } catch (err) {
      console.error("Error terminando llamada:", err);
    }
  };
  const toggleMute = () => {
    if (!audioSender.value || !audioSender.value.track) return;
    const isTrackEnabled = audioSender.value.track.enabled;
    audioSender.value.track.enabled = !isTrackEnabled;
    isMuted.value = !isTrackEnabled;
  };
  return {
    userAgent,
    isRegistered,
    isConnected,
    connectionState,
    error,
    sipConfig,
    currentCall,
    incomingCall,
    voicemail,
    isMuted,
    isDnd,
    callState,
    callStartTime,
    toggleMute,
    makeCall,
    endCall,
    initializeSip
  };
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNpcFN0b3JlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRlZmluZVN0b3JlIH0gZnJvbSAncGluaWEnXHJcbmltcG9ydCB7IFVSSSwgVXNlckFnZW50IH0gZnJvbSAnc2lwLmpzJ1xyXG5pbXBvcnQgeyByZWYgfSBmcm9tICd2dWUnXHJcbmltcG9ydCB7IEludml0ZXIsIEludml0YXRpb24sIE5vdGlmaWNhdGlvbiwgU2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlciAgICB9IGZyb20gJ3NpcC5qcydcclxuXHJcbmV4cG9ydCBjb25zdCB1c2VTaXBTdG9yZSA9IGRlZmluZVN0b3JlKCdzaXAnLCAoKSA9PiB7XHJcbiAgY29uc3QgdXNlckFnZW50ID0gcmVmKClcclxuICAvLyBjb25zdCByZWdpc3RlcmVyID0gcmVmKG51bGwpXHJcbiAgY29uc3Qgdm9pY2VtYWlsID0gcmVmKHsgbmV3OiAwLCBvbGQ6IDAgfSlcclxuICBjb25zdCBpc0RuZCA9IHJlZihmYWxzZSlcclxuICBjb25zdCBpc1JlZ2lzdGVyZWQgPSByZWYoZmFsc2UpXHJcbiAgY29uc3QgaXNDb25uZWN0ZWQgPSByZWYoZmFsc2UpXHJcbiAgY29uc3QgY3VycmVudENhbGwgPSByZWY8SW52aXRlciB8IEludml0YXRpb24gfCBudWxsPihudWxsKVxyXG4gIGNvbnN0IGluY29taW5nQ2FsbCA9IHJlZjxJbnZpdGF0aW9uIHwgbnVsbD4obnVsbClcclxuICBjb25zdCBjYWxsU3RhdGUgPSByZWY8J2lkbGUnIHwgJ2NhbGxpbmcnIHwgJ3JpbmdpbmcnIHwgJ2Nvbm5lY3RlZCcgfCAnZW5kZWQnPignaWRsZScpXHJcbiAgY29uc3QgY29ubmVjdGlvblN0YXRlID0gcmVmKCdkaXNjb25uZWN0ZWQnKSAvLyBkaXNjb25uZWN0ZWQsIGNvbm5lY3RpbmcsIGNvbm5lY3RlZCwgcmVjb25uZWN0aW5nXHJcbiAgY29uc3QgY2FsbFN0YXJ0VGltZSA9IHJlZjxEYXRlIHwgbnVsbD4obnVsbClcclxuICBjb25zdCBlcnJvciA9IHJlZihudWxsKVxyXG4gIGNvbnN0IGlzTXV0ZWQgPSByZWYoZmFsc2UpXHJcbiAgY29uc3QgYXVkaW9TZW5kZXIgPSByZWY8UlRDUnRwU2VuZGVyIHwgbnVsbD4obnVsbClcclxuXHJcbiAgLy8gY29uc3QgYXVkaW9FbGVtZW50ID0gcmVmKG51bGwpXHJcblxyXG4gIGNvbnN0IHNpcENvbmZpZyA9IHJlZih7XHJcbiAgICBzZXJ2ZXI6ICd3c3M6Ly9ob3JuYmxvd2VyLmRvZXNub3RleGlzdC5jb206NzQ0MycsXHJcbiAgICB1c2VybmFtZTogJycsXHJcbiAgICBwYXNzd29yZDogJycsXHJcbiAgICBkb21haW46ICdob3JuYmxvd2VyLmRvZXNub3RleGlzdC5jb20nLFxyXG4gICAgZGlzcGxheU5hbWU6ICcnLFxyXG4gIH0pXHJcblxyXG4gIGNvbnN0IGluaXRpYWxpemVTaXAgPSBhc3luYyAoXHJcbiAgICBjb25maWc6XHJcbiAgICAgIHwgeyBzZXJ2ZXI6IHN0cmluZzsgdXNlcm5hbWU6IHN0cmluZzsgcGFzc3dvcmQ6IHN0cmluZzsgZG9tYWluOiBzdHJpbmc7IGRpc3BsYXlOYW1lOiBzdHJpbmcgfVxyXG4gICAgICB8IHsgc2VydmVyOiBzdHJpbmc7IHVzZXJuYW1lOiBzdHJpbmc7IHBhc3N3b3JkOiBzdHJpbmc7IGRvbWFpbjogc3RyaW5nOyBkaXNwbGF5TmFtZTogc3RyaW5nIH0sXHJcbiAgKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBBY3R1YWxpemFyIGNvbmZpZ3VyYWNpw7NuXHJcbiAgICAgIHNpcENvbmZpZy52YWx1ZSA9IHsgLi4uc2lwQ29uZmlnLnZhbHVlLCAuLi5jb25maWcgfVxyXG5cclxuICAgICAgY29ubmVjdGlvblN0YXRlLnZhbHVlID0gJ2Nvbm5lY3RpbmcnXHJcbiAgICAgIGVycm9yLnZhbHVlID0gbnVsbFxyXG5cclxuICAgICAgLy8gQ3JlYXIgVXNlckFnZW50XHJcbiAgICAgIGNvbnN0IHVyaSA9IG5ldyBVUkkoJ3NpcCcsIHNpcENvbmZpZy52YWx1ZS51c2VybmFtZSwgc2lwQ29uZmlnLnZhbHVlLmRvbWFpbiwgNTA2MClcclxuICAgICAgY29uc3QgdHJhbnNwb3J0T3B0aW9ucyA9IHtcclxuICAgICAgICBzZXJ2ZXI6ICd3c3M6Ly9ob3JuYmxvd2VyLmRvZXNub3RleGlzdC5jb206NzQ0MycsXHJcbiAgICAgICAgY29ubmVjdGlvblRpbWVvdXQ6IDEwMDAwLFxyXG4gICAgICAgIGtlZXBBbGl2ZUludGVydmFsOiAzMDAwMCxcclxuICAgICAgICB0cmFjZVNpcDogdHJ1ZSxcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgdXNlckFnZW50T3B0aW9ucyA9IHtcclxuICAgICAgICB1cmksXHJcbiAgICAgICAgdHJhbnNwb3J0T3B0aW9ucyxcclxuICAgICAgICB1c2VyQWdlbnRTdHJpbmc6ICdTSVAuanMvMC43LjggU2FyYVBob25lIDA0JyxcclxuICAgICAgICB0cmFjZVNpcDogdHJ1ZSxcclxuICAgICAgICBpY2VDaGVja2luZ1RpbWVvdXQ6IDEwMDAsXHJcbiAgICAgICAgcmVnaXN0ZXJFeHBpcmVzOiAxMjAsXHJcbiAgICAgICAgYWxsb3dMZWdhY3lOb3RpZmljYXRpb25zOiB0cnVlLFxyXG4gICAgICAgIGhhY2tXc3NJblRyYW5zcG9ydDogdHJ1ZSxcclxuICAgICAgICB3c1NlcnZlck1heFJlY29ubmVjdGlvbjogNTAwMCxcclxuICAgICAgICB3c1NlcnZlclJlY29ubmVjdGlvblRpbWVvdXQ6IDEsXHJcbiAgICAgICAgY29ubmVjdGlvblJlY292ZXJ5TWF4SW50ZXJ2YWw6IDMsXHJcbiAgICAgICAgY29ubmVjdGlvblJlY292ZXJ5TWluSW50ZXJ2YWw6IDIsXHJcbiAgICAgICAgZGVsZWdhdGU6IHtcclxuICAgICAgICAgIG9uQ29ubmVjdDogKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnU0lQIGNvbmVjdGFkbycpXHJcbiAgICAgICAgICAgIGlzQ29ubmVjdGVkLnZhbHVlID0gdHJ1ZVxyXG4gICAgICAgICAgICBjb25uZWN0aW9uU3RhdGUudmFsdWUgPSAnY29ubmVjdGVkJ1xyXG4gICAgICAgICAgICAvLyByZWdpc3RlcigpXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgb25EaXNjb25uZWN0OiAoZXJyb3I6IHVua25vd24pID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1NJUCBkZXNjb25lY3RhZG8nLCBlcnJvcilcclxuICAgICAgICAgICAgaXNDb25uZWN0ZWQudmFsdWUgPSBmYWxzZVxyXG4gICAgICAgICAgICBpc1JlZ2lzdGVyZWQudmFsdWUgPSBmYWxzZVxyXG4gICAgICAgICAgICBjb25uZWN0aW9uU3RhdGUudmFsdWUgPSAnZGlzY29ubmVjdGVkJ1xyXG4gICAgICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICBjb25uZWN0aW9uU3RhdGUudmFsdWUgPSAncmVjb25uZWN0aW5nJ1xyXG4gICAgICAgICAgICAgIC8vIEludGVudGFyIHJlY29uZWN0YXIgZGVzcHXDqXMgZGUgNSBzZWd1bmRvc1xyXG4gICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHVzZXJBZ2VudC52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICB1c2VyQWdlbnQudmFsdWUuc3RhcnQoKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0sIDUwMDApXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBvbkludml0ZTogKGludml0YXRpb246IEludml0YXRpb24pID0+IHtcclxuICAgICAgICAgICAgaWYgKGlzRG5kLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0xsYW1hZGEgZW50cmFudGUgaWdub3JhZGEgcG9yIERORCcpXHJcbiAgICAgICAgICAgICAgaW52aXRhdGlvbi5yZWplY3QoKVxyXG4gICAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGN1cnJlbnRDYWxsLnZhbHVlID0gaW52aXRhdGlvblxyXG4gICAgICAgICAgICBjYWxsU3RhdGUudmFsdWUgPSAncmluZ2luZydcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgfVxyXG5cclxuICAgICAgdXNlckFnZW50LnZhbHVlID0gbmV3IFVzZXJBZ2VudCh1c2VyQWdlbnRPcHRpb25zKVxyXG5cclxuICAgICAgdXNlckFnZW50LnZhbHVlLmRlbGVnYXRlID0ge1xyXG4gICAgICAgIC4uLnVzZXJBZ2VudC52YWx1ZS5kZWxlZ2F0ZSxcclxuICAgICAgICBvbk5vdGlmeTogKG5vdGlmaWNhdGlvbjogTm90aWZpY2F0aW9uKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBib2R5ID0gbm90aWZpY2F0aW9uLnJlcXVlc3QuYm9keVxyXG4gICAgICAgICAgY29uc3QgbWF0Y2ggPSBib2R5Lm1hdGNoKC92b2ljZS1tZXNzYWdlOlxccyooXFxkKylcXC8oXFxkKykvaSlcclxuXHJcbiAgICAgICAgICBpZiAobWF0Y2gpIHtcclxuICAgICAgICAgICAgY29uc3QgbmV3TWVzc2FnZXMgPSBwYXJzZUludChtYXRjaFsxXSA/PyAnMCcpXHJcbiAgICAgICAgICAgIGNvbnN0IG9sZE1lc3NhZ2VzID0gcGFyc2VJbnQobWF0Y2hbMl0gPz8gJzAnKVxyXG4gICAgICAgICAgICB2b2ljZW1haWwudmFsdWUgPSB7IG5ldzogbmV3TWVzc2FnZXMsIG9sZDogb2xkTWVzc2FnZXMgfVxyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIG5vdGlmaWNhdGlvbi5hY2NlcHQoKVxyXG4gICAgICAgIH0sXHJcbiAgICAgIH1cclxuICAgICAgLy8gSW5pY2lhciBVc2VyQWdlbnRcclxuICAgICAgYXdhaXQgdXNlckFnZW50LnZhbHVlLnN0YXJ0KClcclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbmljaWFsaXphbmRvIFNJUDonLCBlcnIpXHJcbiAgICAgIGNvbm5lY3Rpb25TdGF0ZS52YWx1ZSA9ICdkaXNjb25uZWN0ZWQnXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjb25zdCBtYWtlQ2FsbCA9IGFzeW5jIChudW1iZXI6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4gPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKCF1c2VyQWdlbnQudmFsdWUgfHwgIWlzQ29ubmVjdGVkLnZhbHVlKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTSVAgbm8gZXN0w6EgY29uZWN0YWRvJylcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgdGFyZ2V0ID0gbmV3IFVSSSgnc2lwJywgbnVtYmVyLCBzaXBDb25maWcudmFsdWUuZG9tYWluKVxyXG4gICAgICBjb25zdCBpbnZpdGVyID0gbmV3IEludml0ZXIodXNlckFnZW50LnZhbHVlLCB0YXJnZXQsIHtcclxuICAgICAgICBzZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyT3B0aW9uczoge1xyXG4gICAgICAgICAgY29uc3RyYWludHM6IHsgYXVkaW86IHRydWUsIHZpZGVvOiBmYWxzZSB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pXHJcblxyXG4gICAgICBjdXJyZW50Q2FsbC52YWx1ZSA9IGludml0ZXJcclxuICAgICAgY2FsbFN0YXRlLnZhbHVlID0gJ2NhbGxpbmcnXHJcbiAgICAgIGNhbGxTdGFydFRpbWUudmFsdWUgPSBuZXcgRGF0ZSgpXHJcblxyXG4gICAgICAvLyBDb25maWd1cmFyIGV2ZW50b3MgcGFyYSBtYW5lamFyIGxhIGxsYW1hZGFcclxuICAgICAgaW52aXRlci5zdGF0ZUNoYW5nZS5hZGRMaXN0ZW5lcigoc3RhdGUpID0+IHtcclxuICAgICAgICBpZiAoc3RhdGUgPT09ICdFc3RhYmxpc2hlZCcpIHtcclxuICAgICAgICAgIGNvbnN0IGhhbmRsZXIgPSBpbnZpdGVyLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIgYXMgV2ViU2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlclxyXG4gICAgICAgICAgY29uc3QgcGMgPSBoYW5kbGVyLnBlZXJDb25uZWN0aW9uXHJcblxyXG4gICAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IGludml0ZXIuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlclxyXG4gICAgICAgICAgaWYgKHNlc3Npb24gJiYgc2Vzc2lvbi5wZWVyQ29ubmVjdGlvbikge1xyXG4gICAgICAgICAgICBjb25zdCBzZW5kZXJzID0gc2Vzc2lvbi5wZWVyQ29ubmVjdGlvbi5nZXRTZW5kZXJzKClcclxuICAgICAgICAgICAgYXVkaW9TZW5kZXIudmFsdWUgPVxyXG4gICAgICAgICAgICAgIHNlbmRlcnMuZmluZCgoc2VuZGVyOiBSVENSdHBTZW5kZXIpID0+IHNlbmRlci50cmFjaz8ua2luZCA9PT0gJ2F1ZGlvJykgfHwgbnVsbFxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHN0YXRlID09PSAnVGVybWluYXRlZCcpIHtcclxuICAgICAgICAgIGF1ZGlvU2VuZGVyLnZhbHVlID0gbnVsbFxyXG4gICAgICAgICAgaXNNdXRlZC52YWx1ZSA9IGZhbHNlXHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG5cclxuICAgICAgYXdhaXQgaW52aXRlci5pbnZpdGUoKVxyXG4gICAgICByZXR1cm4gdHJ1ZVxyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGhhY2llbmRvIGxsYW1hZGE6JywgZXJyKVxyXG4gICAgICBjYWxsU3RhdGUudmFsdWUgPSAnaWRsZSdcclxuICAgICAgY3VycmVudENhbGwudmFsdWUgPSBudWxsXHJcbiAgICAgIHJldHVybiBmYWxzZVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY29uc3QgZW5kQ2FsbCA9IGFzeW5jICgpOiBQcm9taXNlPHZvaWQ+ID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmIChjdXJyZW50Q2FsbC52YWx1ZSkge1xyXG4gICAgICAgIGlmIChjdXJyZW50Q2FsbC52YWx1ZSBpbnN0YW5jZW9mIEludml0ZXIpIHtcclxuICAgICAgICAgIGF3YWl0IGN1cnJlbnRDYWxsLnZhbHVlLmNhbmNlbCgpXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIGF3YWl0IGN1cnJlbnRDYWxsLnZhbHVlLnJlamVjdCgpXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBjYWxsU3RhdGUudmFsdWUgPSAnZW5kZWQnXHJcbiAgICAgIGN1cnJlbnRDYWxsLnZhbHVlID0gbnVsbFxyXG4gICAgICBjYWxsU3RhcnRUaW1lLnZhbHVlID0gbnVsbFxyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHRlcm1pbmFuZG8gbGxhbWFkYTonLCBlcnIpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjb25zdCB0b2dnbGVNdXRlID0gKCkgPT4ge1xyXG4gICAgaWYgKCFhdWRpb1NlbmRlci52YWx1ZSB8fCAhYXVkaW9TZW5kZXIudmFsdWUudHJhY2spIHJldHVyblxyXG5cclxuICAgIGNvbnN0IGlzVHJhY2tFbmFibGVkID0gYXVkaW9TZW5kZXIudmFsdWUudHJhY2suZW5hYmxlZFxyXG5cclxuICAgIGF1ZGlvU2VuZGVyLnZhbHVlLnRyYWNrLmVuYWJsZWQgPSAhaXNUcmFja0VuYWJsZWRcclxuICAgIGlzTXV0ZWQudmFsdWUgPSAhaXNUcmFja0VuYWJsZWRcclxuICB9XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICB1c2VyQWdlbnQsXHJcbiAgICBpc1JlZ2lzdGVyZWQsXHJcbiAgICBpc0Nvbm5lY3RlZCxcclxuICAgIGNvbm5lY3Rpb25TdGF0ZSxcclxuICAgIGVycm9yLFxyXG4gICAgc2lwQ29uZmlnLFxyXG4gICAgY3VycmVudENhbGwsXHJcbiAgICBpbmNvbWluZ0NhbGwsXHJcbiAgICB2b2ljZW1haWwsXHJcbiAgICBpc011dGVkLFxyXG4gICAgaXNEbmQsXHJcbiAgICBjYWxsU3RhdGUsXHJcbiAgICBjYWxsU3RhcnRUaW1lLFxyXG4gICAgdG9nZ2xlTXV0ZSxcclxuICAgIG1ha2VDYWxsLFxyXG4gICAgZW5kQ2FsbCxcclxuICAgIGluaXRpYWxpemVTaXAsXHJcbiAgfVxyXG59KVxyXG4iXSwibWFwcGluZ3MiOiJBQUFBLFNBQVMsbUJBQW1CO0FBQzVCLFNBQVMsS0FBSyxpQkFBaUI7QUFDL0IsU0FBUyxXQUFXO0FBQ3BCLFNBQVMsU0FBUyxZQUFZLGNBQWMsaUNBQW9DO0FBRXpFLGFBQU0sY0FBYyxZQUFZLE9BQU8sTUFBTTtBQUNsRCxRQUFNLFlBQVksSUFBSTtBQUV0QixRQUFNLFlBQVksSUFBSSxFQUFFLEtBQUssR0FBRyxLQUFLLEVBQUUsQ0FBQztBQUN4QyxRQUFNLFFBQVEsSUFBSSxLQUFLO0FBQ3ZCLFFBQU0sZUFBZSxJQUFJLEtBQUs7QUFDOUIsUUFBTSxjQUFjLElBQUksS0FBSztBQUM3QixRQUFNLGNBQWMsSUFBaUMsSUFBSTtBQUN6RCxRQUFNLGVBQWUsSUFBdUIsSUFBSTtBQUNoRCxRQUFNLFlBQVksSUFBNEQsTUFBTTtBQUNwRixRQUFNLGtCQUFrQixJQUFJLGNBQWM7QUFDMUMsUUFBTSxnQkFBZ0IsSUFBaUIsSUFBSTtBQUMzQyxRQUFNLFFBQVEsSUFBSSxJQUFJO0FBQ3RCLFFBQU0sVUFBVSxJQUFJLEtBQUs7QUFDekIsUUFBTSxjQUFjLElBQXlCLElBQUk7QUFJakQsUUFBTSxZQUFZLElBQUk7QUFBQSxJQUNwQixRQUFRO0FBQUEsSUFDUixVQUFVO0FBQUEsSUFDVixVQUFVO0FBQUEsSUFDVixRQUFRO0FBQUEsSUFDUixhQUFhO0FBQUEsRUFDZixDQUFDO0FBRUQsUUFBTSxnQkFBZ0IsT0FDcEIsV0FHRztBQUNILFFBQUk7QUFFRixnQkFBVSxRQUFRLEVBQUUsR0FBRyxVQUFVLE9BQU8sR0FBRyxPQUFPO0FBRWxELHNCQUFnQixRQUFRO0FBQ3hCLFlBQU0sUUFBUTtBQUdkLFlBQU0sTUFBTSxJQUFJLElBQUksT0FBTyxVQUFV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
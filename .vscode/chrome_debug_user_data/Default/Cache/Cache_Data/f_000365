import { defineStore } from "/node_modules/.vite/deps/pinia.js?v=84e5e045";
import { URI, UserAgent } from "/node_modules/.vite/deps/sip__js.js?v=84e5e045";
import { ref } from "/node_modules/.vite/deps/vue.js?v=84e5e045";
import { Inviter, Invitation, Notification } from "/node_modules/.vite/deps/sip__js.js?v=84e5e045";
export const useSipStore = defineStore("sip", () => {
  const userAgent = ref();
  const voicemail = ref({ new: 0, old: 0 });
  const isDnd = ref(false);
  const isRegistered = ref(false);
  const isConnected = ref(false);
  const currentCall = ref(null);
  const incomingCall = ref(null);
  const callState = ref("idle");
  const connectionState = ref("disconnected");
  const callStartTime = ref(null);
  const error = ref(null);
  const isMuted = ref(false);
  const sipConfig = ref({
    server: "wss://hornblower.doesnotexist.com:7443",
    username: "",
    password: "",
    domain: "hornblower.doesnotexist.com",
    displayName: ""
  });
  const initializeSip = async (config) => {
    try {
      sipConfig.value = { ...sipConfig.value, ...config };
      connectionState.value = "connecting";
      error.value = null;
      const uri = new URI("sip", sipConfig.value.username, sipConfig.value.domain, 5060);
      const transportOptions = {
        server: "wss://hornblower.doesnotexist.com:7443",
        connectionTimeout: 1e4,
        keepAliveInterval: 3e4,
        traceSip: true
      };
      const userAgentOptions = {
        uri,
        transportOptions,
        userAgentString: "SIP.js/0.7.8 SaraPhone 04",
        traceSip: true,
        iceCheckingTimeout: 1e3,
        registerExpires: 120,
        allowLegacyNotifications: true,
        hackWssInTransport: true,
        wsServerMaxReconnection: 5e3,
        wsServerReconnectionTimeout: 1,
        connectionRecoveryMaxInterval: 3,
        connectionRecoveryMinInterval: 2,
        delegate: {
          onConnect: () => {
            console.log("SIP conectado");
            isConnected.value = true;
            connectionState.value = "connected";
          },
          onDisconnect: (error2) => {
            console.log("SIP desconectado", error2);
            isConnected.value = false;
            isRegistered.value = false;
            connectionState.value = "disconnected";
            if (error2) {
              connectionState.value = "reconnecting";
              setTimeout(() => {
                if (userAgent.value) {
                  userAgent.value.start();
                }
              }, 5e3);
            }
          },
          onInvite: (invitation) => {
            if (isDnd.value) {
              console.log("Llamada entrante ignorada por DND");
              invitation.reject();
              return;
            }
            currentCall.value = invitation;
            callState.value = "ringing";
          }
        }
      };
      userAgent.value = new UserAgent(userAgentOptions);
      userAgent.value.delegate = {
        ...userAgent.value.delegate,
        onNotify: (notification) => {
          const body = notification.request.body;
          const match = body.match(/voice-message:\s*(\d+)\/(\d+)/i);
          if (match) {
            const newMessages = parseInt(match[1] ?? "0");
            const oldMessages = parseInt(match[2] ?? "0");
            voicemail.value = { new: newMessages, old: oldMessages };
          }
          notification.accept();
        }
      };
      await userAgent.value.start();
    } catch (err) {
      console.error("Error inicializando SIP:", err);
      connectionState.value = "disconnected";
    }
  };
  const makeCall = async (number) => {
    try {
      if (!userAgent.value || !isConnected.value) {
        throw new Error("SIP no estÃ¡ conectado");
      }
      const target = new URI("sip", number, sipConfig.value.domain);
      const inviter = new Inviter(userAgent.value, target);
      currentCall.value = inviter;
      callState.value = "calling";
      callStartTime.value = /* @__PURE__ */ new Date();
      isMuted.value = false;
      inviter.stateChange.addListener((state) => {
        if (state === "Establishing") {
          console.log("Llamada creada");
        }
        if (state === "Established") {
          console.log("Llamada contestada");
          callState.value = "connected";
        }
        if (state === "Terminated") {
          console.log("Llamada terminada");
          callState.value = "ended";
          currentCall.value = null;
          callStartTime.value = null;
          isMuted.value = false;
        }
      });
      await inviter.invite();
      return true;
    } catch (err) {
      console.error("Error haciendo llamada:", err);
      callState.value = "idle";
      currentCall.value = null;
      return false;
    }
  };
  const endCall = async () => {
    try {
      if (currentCall.value) {
        if (currentCall.value instanceof Inviter) {
          await currentCall.value.cancel();
        } else {
        }
      }
      callState.value = "ended";
      currentCall.value = null;
      callStartTime.value = null;
      isMuted.value = false;
    } catch (err) {
      console.error("Error terminando llamada:", err);
    }
  };
  const toggleMute = async () => {
    try {
      if (!currentCall.value) {
        console.warn("No hay llamada activa para mutear");
        return false;
      }
      if (isMuted.value) {
        if (typeof currentCall.value.unmute === "function") {
          await currentCall.value.unmute();
        }
        isMuted.value = false;
        console.log("Llamada desmuteada");
      } else {
        if (typeof currentCall.value.mute === "function") {
          await currentCall.value.mute();
        }
        isMuted.value = true;
        console.log("Llamada muteada");
      }
      return true;
    } catch (err) {
      console.error("Error al mutear/desmutear:", err);
      return false;
    }
  };
  return {
    userAgent,
    isRegistered,
    isConnected,
    connectionState,
    error,
    sipConfig,
    currentCall,
    incomingCall,
    voicemail,
    isDnd,
    callState,
    callStartTime,
    isMuted,
    makeCall,
    endCall,
    toggleMute,
    initializeSip
  };
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNpcFN0b3JlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRlZmluZVN0b3JlIH0gZnJvbSAncGluaWEnXHJcbmltcG9ydCB7IFVSSSwgVXNlckFnZW50IH0gZnJvbSAnc2lwLmpzJ1xyXG5pbXBvcnQgeyByZWYgfSBmcm9tICd2dWUnXHJcbmltcG9ydCB7IEludml0ZXIsIEludml0YXRpb24sIE5vdGlmaWNhdGlvbiB9IGZyb20gJ3NpcC5qcydcclxuXHJcbmV4cG9ydCBjb25zdCB1c2VTaXBTdG9yZSA9IGRlZmluZVN0b3JlKCdzaXAnLCAoKSA9PiB7XHJcbiAgY29uc3QgdXNlckFnZW50ID0gcmVmKClcclxuICAvLyBjb25zdCByZWdpc3RlcmVyID0gcmVmKG51bGwpXHJcbiAgY29uc3Qgdm9pY2VtYWlsID0gcmVmKHsgbmV3OiAwLCBvbGQ6IDAgfSlcclxuICBjb25zdCBpc0RuZCA9IHJlZihmYWxzZSlcclxuICBjb25zdCBpc1JlZ2lzdGVyZWQgPSByZWYoZmFsc2UpXHJcbiAgY29uc3QgaXNDb25uZWN0ZWQgPSByZWYoZmFsc2UpXHJcbiAgY29uc3QgY3VycmVudENhbGwgPSByZWY8SW52aXRlciB8IEludml0YXRpb24gfCBudWxsPihudWxsKVxyXG4gIGNvbnN0IGluY29taW5nQ2FsbCA9IHJlZjxJbnZpdGF0aW9uIHwgbnVsbD4obnVsbClcclxuICBjb25zdCBjYWxsU3RhdGUgPSByZWY8J2lkbGUnIHwgJ2NhbGxpbmcnIHwgJ3JpbmdpbmcnIHwgJ2Nvbm5lY3RlZCcgfCAnZW5kZWQnPignaWRsZScpXHJcbiAgY29uc3QgY29ubmVjdGlvblN0YXRlID0gcmVmKCdkaXNjb25uZWN0ZWQnKSAvLyBkaXNjb25uZWN0ZWQsIGNvbm5lY3RpbmcsIGNvbm5lY3RlZCwgcmVjb25uZWN0aW5nXHJcbiAgY29uc3QgY2FsbFN0YXJ0VGltZSA9IHJlZjxEYXRlIHwgbnVsbD4obnVsbClcclxuICBjb25zdCBlcnJvciA9IHJlZihudWxsKVxyXG4gIFxyXG4gIC8vIE51ZXZvIGVzdGFkbyBwYXJhIG11dGVcclxuICBjb25zdCBpc011dGVkID0gcmVmKGZhbHNlKVxyXG5cclxuICAvLyBjb25zdCBhdWRpb0VsZW1lbnQgPSByZWYobnVsbClcclxuXHJcbiAgY29uc3Qgc2lwQ29uZmlnID0gcmVmKHtcclxuICAgIHNlcnZlcjogJ3dzczovL2hvcm5ibG93ZXIuZG9lc25vdGV4aXN0LmNvbTo3NDQzJyxcclxuICAgIHVzZXJuYW1lOiAnJyxcclxuICAgIHBhc3N3b3JkOiAnJyxcclxuICAgIGRvbWFpbjogJ2hvcm5ibG93ZXIuZG9lc25vdGV4aXN0LmNvbScsXHJcbiAgICBkaXNwbGF5TmFtZTogJycsXHJcbiAgfSlcclxuXHJcbiAgY29uc3QgaW5pdGlhbGl6ZVNpcCA9IGFzeW5jIChcclxuICAgIGNvbmZpZzpcclxuICAgICAgfCB7IHNlcnZlcjogc3RyaW5nOyB1c2VybmFtZTogc3RyaW5nOyBwYXNzd29yZDogc3RyaW5nOyBkb21haW46IHN0cmluZzsgZGlzcGxheU5hbWU6IHN0cmluZyB9XHJcbiAgICAgIHwgeyBzZXJ2ZXI6IHN0cmluZzsgdXNlcm5hbWU6IHN0cmluZzsgcGFzc3dvcmQ6IHN0cmluZzsgZG9tYWluOiBzdHJpbmc7IGRpc3BsYXlOYW1lOiBzdHJpbmcgfSxcclxuICApID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIEFjdHVhbGl6YXIgY29uZmlndXJhY2nDs25cclxuICAgICAgc2lwQ29uZmlnLnZhbHVlID0geyAuLi5zaXBDb25maWcudmFsdWUsIC4uLmNvbmZpZyB9XHJcblxyXG4gICAgICBjb25uZWN0aW9uU3RhdGUudmFsdWUgPSAnY29ubmVjdGluZydcclxuICAgICAgZXJyb3IudmFsdWUgPSBudWxsXHJcblxyXG4gICAgICAvLyBDcmVhciBVc2VyQWdlbnRcclxuICAgICAgY29uc3QgdXJpID0gbmV3IFVSSSgnc2lwJywgc2lwQ29uZmlnLnZhbHVlLnVzZXJuYW1lLCBzaXBDb25maWcudmFsdWUuZG9tYWluLCA1MDYwKVxyXG4gICAgICBjb25zdCB0cmFuc3BvcnRPcHRpb25zID0ge1xyXG4gICAgICAgIHNlcnZlcjogJ3dzczovL2hvcm5ibG93ZXIuZG9lc25vdGV4aXN0LmNvbTo3NDQzJyxcclxuICAgICAgICBjb25uZWN0aW9uVGltZW91dDogMTAwMDAsXHJcbiAgICAgICAga2VlcEFsaXZlSW50ZXJ2YWw6IDMwMDAwLFxyXG4gICAgICAgIHRyYWNlU2lwOiB0cnVlLFxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCB1c2VyQWdlbnRPcHRpb25zID0ge1xyXG4gICAgICAgIHVyaSxcclxuICAgICAgICB0cmFuc3BvcnRPcHRpb25zLFxyXG4gICAgICAgIHVzZXJBZ2VudFN0cmluZzogJ1NJUC5qcy8wLjcuOCBTYXJhUGhvbmUgMDQnLFxyXG4gICAgICAgIHRyYWNlU2lwOiB0cnVlLFxyXG4gICAgICAgIGljZUNoZWNraW5nVGltZW91dDogMTAwMCxcclxuICAgICAgICByZWdpc3RlckV4cGlyZXM6IDEyMCxcclxuICAgICAgICBhbGxvd0xlZ2FjeU5vdGlmaWNhdGlvbnM6IHRydWUsXHJcbiAgICAgICAgaGFja1dzc0luVHJhbnNwb3J0OiB0cnVlLFxyXG4gICAgICAgIHdzU2VydmVyTWF4UmVjb25uZWN0aW9uOiA1MDAwLFxyXG4gICAgICAgIHdzU2VydmVyUmVjb25uZWN0aW9uVGltZW91dDogMSxcclxuICAgICAgICBjb25uZWN0aW9uUmVjb3ZlcnlNYXhJbnRlcnZhbDogMyxcclxuICAgICAgICBjb25uZWN0aW9uUmVjb3ZlcnlNaW5JbnRlcnZhbDogMixcclxuICAgICAgICBkZWxlZ2F0ZToge1xyXG4gICAgICAgICAgb25Db25uZWN0OiAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTSVAgY29uZWN0YWRvJylcclxuICAgICAgICAgICAgaXNDb25uZWN0ZWQudmFsdWUgPSB0cnVlXHJcbiAgICAgICAgICAgIGNvbm5lY3Rpb25TdGF0ZS52YWx1ZSA9ICdjb25uZWN0ZWQnXHJcbiAgICAgICAgICAgIC8vIHJlZ2lzdGVyKClcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBvbkRpc2Nvbm5lY3Q6IChlcnJvcjogdW5rbm93bikgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnU0lQIGRlc2NvbmVjdGFkbycsIGVycm9yKVxyXG4gICAgICAgICAgICBpc0Nvbm5lY3RlZC52YWx1ZSA9IGZhbHNlXHJcbiAgICAgICAgICAgIGlzUmVnaXN0ZXJlZC52YWx1ZSA9IGZhbHNlXHJcbiAgICAgICAgICAgIGNvbm5lY3Rpb25TdGF0ZS52YWx1ZSA9ICdkaXNjb25uZWN0ZWQnXHJcbiAgICAgICAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgICAgICAgIGNvbm5lY3Rpb25TdGF0ZS52YWx1ZSA9ICdyZWNvbm5lY3RpbmcnXHJcbiAgICAgICAgICAgICAgLy8gSW50ZW50YXIgcmVjb25lY3RhciBkZXNwdcOpcyBkZSA1IHNlZ3VuZG9zXHJcbiAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodXNlckFnZW50LnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgIHVzZXJBZ2VudC52YWx1ZS5zdGFydCgpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfSwgNTAwMClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIG9uSW52aXRlOiAoaW52aXRhdGlvbjogSW52aXRhdGlvbikgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaXNEbmQudmFsdWUpIHtcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnTGxhbWFkYSBlbnRyYW50ZSBpZ25vcmFkYSBwb3IgRE5EJylcclxuICAgICAgICAgICAgICBpbnZpdGF0aW9uLnJlamVjdCgpXHJcbiAgICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY3VycmVudENhbGwudmFsdWUgPSBpbnZpdGF0aW9uXHJcbiAgICAgICAgICAgIGNhbGxTdGF0ZS52YWx1ZSA9ICdyaW5naW5nJ1xyXG4gICAgICAgICAgfSxcclxuICAgICAgICB9LFxyXG4gICAgICB9XHJcblxyXG4gICAgICB1c2VyQWdlbnQudmFsdWUgPSBuZXcgVXNlckFnZW50KHVzZXJBZ2VudE9wdGlvbnMpXHJcblxyXG4gICAgICB1c2VyQWdlbnQudmFsdWUuZGVsZWdhdGUgPSB7XHJcbiAgICAgICAgLi4udXNlckFnZW50LnZhbHVlLmRlbGVnYXRlLFxyXG4gICAgICAgIG9uTm90aWZ5OiAobm90aWZpY2F0aW9uOiBOb3RpZmljYXRpb24pID0+IHtcclxuICAgICAgICAgIGNvbnN0IGJvZHkgPSBub3RpZmljYXRpb24ucmVxdWVzdC5ib2R5XHJcbiAgICAgICAgICBjb25zdCBtYXRjaCA9IGJvZHkubWF0Y2goL3ZvaWNlLW1lc3NhZ2U6XFxzKihcXGQrKVxcLyhcXGQrKS9pKVxyXG5cclxuICAgICAgICAgIGlmIChtYXRjaCkge1xyXG4gICAgICAgICAgICBjb25zdCBuZXdNZXNzYWdlcyA9IHBhcnNlSW50KG1hdGNoWzFdID8/ICcwJylcclxuICAgICAgICAgICAgY29uc3Qgb2xkTWVzc2FnZXMgPSBwYXJzZUludChtYXRjaFsyXSA/PyAnMCcpXHJcbiAgICAgICAgICAgIHZvaWNlbWFpbC52YWx1ZSA9IHsgbmV3OiBuZXdNZXNzYWdlcywgb2xkOiBvbGRNZXNzYWdlcyB9XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgbm90aWZpY2F0aW9uLmFjY2VwdCgpIFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH1cclxuICAgICAgLy8gSW5pY2lhciBVc2VyQWdlbnRcclxuICAgICAgYXdhaXQgdXNlckFnZW50LnZhbHVlLnN0YXJ0KClcclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbmljaWFsaXphbmRvIFNJUDonLCBlcnIpXHJcbiAgICAgIGNvbm5lY3Rpb25TdGF0ZS52YWx1ZSA9ICdkaXNjb25uZWN0ZWQnXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjb25zdCBtYWtlQ2FsbCA9IGFzeW5jIChudW1iZXI6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4gPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKCF1c2VyQWdlbnQudmFsdWUgfHwgIWlzQ29ubmVjdGVkLnZhbHVlKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTSVAgbm8gZXN0w6EgY29uZWN0YWRvJylcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgdGFyZ2V0ID0gbmV3IFVSSSgnc2lwJywgbnVtYmVyLCBzaXBDb25maWcudmFsdWUuZG9tYWluKVxyXG4gICAgICBjb25zdCBpbnZpdGVyID0gbmV3IEludml0ZXIodXNlckFnZW50LnZhbHVlLCB0YXJnZXQpXHJcblxyXG4gICAgICBjdXJyZW50Q2FsbC52YWx1ZSA9IGludml0ZXJcclxuICAgICAgY2FsbFN0YXRlLnZhbHVlID0gJ2NhbGxpbmcnXHJcbiAgICAgIGNhbGxTdGFydFRpbWUudmFsdWUgPSBuZXcgRGF0ZSgpXHJcblxyXG4gICAgICAvLyBSZXNldGVhciBlc3RhZG8gZGUgbXV0ZSBhbCBpbmljaWFyIHVuYSBudWV2YSBsbGFtYWRhXHJcbiAgICAgIGlzTXV0ZWQudmFsdWUgPSBmYWxzZVxyXG5cclxuICAgICAgLy8gQ29uZmlndXJhciBldmVudG9zIHBhcmEgbWFuZWphciBsYSBsbGFtYWRhXHJcbiAgICAgIGludml0ZXIuc3RhdGVDaGFuZ2UuYWRkTGlzdGVuZXIoKHN0YXRlKSA9PiB7XHJcbiAgICAgICAgaWYgKHN0YXRlID09PSAnRXN0YWJsaXNoaW5nJykge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coJ0xsYW1hZGEgY3JlYWRhJylcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHN0YXRlID09PSAnRXN0YWJsaXNoZWQnKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnTGxhbWFkYSBjb250ZXN0YWRhJylcclxuICAgICAgICAgIGNhbGxTdGF0ZS52YWx1ZSA9ICdjb25uZWN0ZWQnXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzdGF0ZSA9PT0gJ1Rlcm1pbmF0ZWQnKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnTGxhbWFkYSB0ZXJtaW5hZGEnKVxyXG4gICAgICAgICAgY2FsbFN0YXRlLnZhbHVlID0gJ2VuZGVkJ1xyXG4gICAgICAgICAgY3VycmVudENhbGwudmFsdWUgPSBudWxsXHJcbiAgICAgICAgICBjYWxsU3RhcnRUaW1lLnZhbHVlID0gbnVsbFxyXG4gICAgICAgICAgLy8gUmVzZXRlYXIgZXN0YWRvIGRlIG11dGUgYWwgdGVybWluYXIgbGEgbGxhbWFkYVxyXG4gICAgICAgICAgaXNNdXRlZC52YWx1ZSA9IGZhbHNlXHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG5cclxuICAgICAgYXdhaXQgaW52aXRlci5pbnZpdGUoKVxyXG4gICAgICByZXR1cm4gdHJ1ZVxyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGhhY2llbmRvIGxsYW1hZGE6JywgZXJyKVxyXG4gICAgICBjYWxsU3RhdGUudmFsdWUgPSAnaWRsZSdcclxuICAgICAgY3VycmVudENhbGwudmFsdWUgPSBudWxsXHJcbiAgICAgIHJldHVybiBmYWxzZVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY29uc3QgZW5kQ2FsbCA9IGFzeW5jICgpOiBQcm9taXNlPHZvaWQ+ID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmIChjdXJyZW50Q2FsbC52YWx1ZSkge1xyXG4gICAgICAgIGlmIChjdXJyZW50Q2FsbC52YWx1ZSBpbnN0YW5jZW9mIEludml0ZXIpIHtcclxuICAgICAgICAgIGF3YWl0IGN1cnJlbnRDYWxsLnZhbHVlLmNhbmNlbCgpXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIGF3YWl0IGN1cnJlbnRDYWxsLnZhbHVlLnJlamVjdCgpXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBjYWxsU3RhdGUudmFsdWUgPSAnZW5kZWQnXHJcbiAgICAgIGN1cnJlbnRDYWxsLnZhbHVlID0gbnVsbFxyXG4gICAgICBjYWxsU3RhcnRUaW1lLnZhbHVlID0gbnVsbFxyXG4gICAgICAvLyBSZXNldGVhciBlc3RhZG8gZGUgbXV0ZSBhbCB0ZXJtaW5hciBsYSBsbGFtYWRhXHJcbiAgICAgIGlzTXV0ZWQudmFsdWUgPSBmYWxzZVxyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHRlcm1pbmFuZG8gbGxhbWFkYTonLCBlcnIpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjb25zdCB0b2dnbGVNdXRlID0gYXN5bmMgKCk6IFByb21pc2U8Ym9vbGVhbj4gPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKCFjdXJyZW50Q2FsbC52YWx1ZSkge1xyXG4gICAgICAgIGNvbnNvbGUud2FybignTm8gaGF5IGxsYW1hZGEgYWN0aXZhIHBhcmEgbXV0ZWFyJylcclxuICAgICAgICByZXR1cm4gZmFsc2VcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGlzTXV0ZWQudmFsdWUpIHtcclxuICAgICAgICAvLyBVbm11dGVcclxuICAgICAgICBpZiAodHlwZW9mIGN1cnJlbnRDYWxsLnZhbHVlLnVubXV0ZSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgYXdhaXQgY3VycmVudENhbGwudmFsdWUudW5tdXRlKClcclxuICAgICAgICB9XHJcbiAgICAgICAgaXNNdXRlZC52YWx1ZSA9IGZhbHNlXHJcbiAgICAgICAgY29uc29sZS5sb2coJ0xsYW1hZGEgZGVzbXV0ZWFkYScpXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gTXV0ZVxyXG4gICAgICAgIGlmICh0eXBlb2YgY3VycmVudENhbGwudmFsdWUubXV0ZSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgYXdhaXQgY3VycmVudENhbGwudmFsdWUubXV0ZSgpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlzTXV0ZWQudmFsdWUgPSB0cnVlXHJcbiAgICAgICAgY29uc29sZS5sb2coJ0xsYW1hZGEgbXV0ZWFkYScpXHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIHJldHVybiB0cnVlXHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgbXV0ZWFyL2Rlc211dGVhcjonLCBlcnIpXHJcbiAgICAgIHJldHVybiBmYWxzZVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIHVzZXJBZ2VudCxcclxuICAgIGlzUmVnaXN0ZXJlZCxcclxuICAgIGlzQ29ubmVjdGVkLFxyXG4gICAgY29ubmVjdGlvblN0YXRlLFxyXG4gICAgZXJyb3IsXHJcbiAgICBzaXBDb25maWcsXHJcbiAgICBjdXJyZW50Q2FsbCxcclxuICAgIGluY29taW5nQ2FsbCxcclxuICAgIHZvaWNlbWFpbCxcclxuICAgIGlzRG5kLFxyXG4gICAgY2FsbFN0YXRlLFxyXG4gICAgY2FsbFN0YXJ0VGltZSxcclxuICAgIGlzTXV0ZWQsXHJcbiAgICBtYWtlQ2FsbCxcclxuICAgIGVuZENhbGwsXHJcbiAgICB0b2dnbGVNdXRlLFxyXG4gICAgaW5pdGlhbGl6ZVNpcCxcclxuICB9XHJcbn0pIl0sIm1hcHBpbmdzIjoiQUFBQSxTQUFTLG1CQUFtQjtBQUM1QixTQUFTLEtBQUssaUJBQWlCO0FBQy9CLFNBQVMsV0FBVztBQUNwQixTQUFTLFNBQVMsWUFBWSxvQkFBb0I7QUFFM0MsYUFBTSxjQUFjLFlBQVksT0FBTyxNQUFNO0FBQ2xELFFBQU0sWUFBWSxJQUFJO0FBRXRCLFFBQU0sWUFBWSxJQUFJLEVBQUUsS0FBSyxHQUFHLEtBQUssRUFBRSxDQUFDO0FBQ3hDLFFBQU0sUUFBUSxJQUFJLEtBQUs7QUFDdkIsUUFBTSxlQUFlLElBQUksS0FBSztBQUM5QixRQUFNLGNBQWMsSUFBSSxLQUFLO0FBQzdC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